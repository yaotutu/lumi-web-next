# æç¤ºè¯ä¼˜åŒ–æ—¥å¿—è¾“å‡ºç¤ºä¾‹

## é…ç½®

ç¡®ä¿åœ¨ `.env.local` ä¸­å·²é…ç½®:

```bash
QWEN_API_KEY=sk-your-api-key
QWEN_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
QWEN_MODEL=qwen-max
ENABLE_PROMPT_OPTIMIZATION=true
```

---

## åœºæ™¯ 1: ä¼˜åŒ–æˆåŠŸ âœ…

### ç”¨æˆ·è¾“å…¥
```
"ä¸€åªå¯çˆ±çš„å°çŒ«"
```

### æ—¥å¿—è¾“å‡º

```json
{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "å¼€å§‹ä¼˜åŒ–æç¤ºè¯",
  "userInput": "ä¸€åªå¯çˆ±çš„å°çŒ«",
  "inputLength": 7
}

{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "âœ… æç¤ºè¯ä¼˜åŒ–æˆåŠŸ",
  "original": "ä¸€åªå¯çˆ±çš„å°çŒ«",
  "optimized": "cute cat figurine, solid structure, smooth surface, stable sitting pose, clear edges, symmetrical design, matte finish, plain white background, 3/4 view, no thin parts, suitable for 3D printing",
  "originalLength": 7,
  "optimizedLength": 128
}

{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "ğŸ“ åŸå§‹æç¤ºè¯",
  "prompt": "ä¸€åªå¯çˆ±çš„å°çŒ«"
}

{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "âœ¨ ä¼˜åŒ–åæç¤ºè¯",
  "prompt": "cute cat figurine, solid structure, smooth surface, stable sitting pose, clear edges, symmetrical design, matte finish, plain white background, 3/4 view, no thin parts, suitable for 3D printing"
}
```

### å…³é”®ä¿¡æ¯æå–

- **åŸå§‹æç¤ºè¯**: `"ä¸€åªå¯çˆ±çš„å°çŒ«"`
- **ä¼˜åŒ–åæç¤ºè¯**: `"cute cat figurine, solid structure, smooth surface, stable sitting pose, clear edges, symmetrical design, matte finish, plain white background, 3/4 view, no thin parts, suitable for 3D printing"`
- **é•¿åº¦å˜åŒ–**: 7 å­—ç¬¦ â†’ 128 å­—ç¬¦

---

## åœºæ™¯ 2: åŠŸèƒ½å…³é—­ âš ï¸

### é…ç½®
```bash
ENABLE_PROMPT_OPTIMIZATION=false
```

### ç”¨æˆ·è¾“å…¥
```
"ä¸€åªå¯çˆ±çš„å°çŒ«"
```

### æ—¥å¿—è¾“å‡º

```json
{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "âš ï¸ æç¤ºè¯ä¼˜åŒ–å·²ç¦ç”¨,ä½¿ç”¨åŸå§‹è¾“å…¥"
}

{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "ğŸ“ ä½¿ç”¨çš„æç¤ºè¯",
  "prompt": "ä¸€åªå¯çˆ±çš„å°çŒ«"
}
```

### å…³é”®ä¿¡æ¯æå–

- **ä½¿ç”¨çš„æç¤ºè¯**: `"ä¸€åªå¯çˆ±çš„å°çŒ«"` (æœªä¼˜åŒ–)
- **çŠ¶æ€**: åŠŸèƒ½å·²ç¦ç”¨

---

## åœºæ™¯ 3: ä¼˜åŒ–å¤±è´¥(è‡ªåŠ¨é™çº§) âš ï¸

### åŸå› ç¤ºä¾‹
- API Key æ— æ•ˆ
- ç½‘ç»œè¶…æ—¶
- é™æµ(429)

### ç”¨æˆ·è¾“å…¥
```
"ä¸€åªå¯çˆ±çš„å°çŒ«"
```

### æ—¥å¿—è¾“å‡º

```json
{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "å¼€å§‹ä¼˜åŒ–æç¤ºè¯",
  "userInput": "ä¸€åªå¯çˆ±çš„å°çŒ«",
  "inputLength": 7
}

{
  "level": "warn",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "âš ï¸ æç¤ºè¯ä¼˜åŒ–å¤±è´¥,é™çº§ä½¿ç”¨åŸå§‹è¾“å…¥",
  "error": "APIè°ƒç”¨å¤±è´¥: 401 Unauthorized",
  "userInput": "ä¸€åªå¯çˆ±çš„å°çŒ«"
}

{
  "level": "info",
  "component": "PromptOptimizer",
  "function": "optimizePromptFor3DPrint",
  "msg": "ğŸ“ é™çº§ä½¿ç”¨åŸå§‹æç¤ºè¯",
  "prompt": "ä¸€åªå¯çˆ±çš„å°çŒ«"
}
```

### å…³é”®ä¿¡æ¯æå–

- **é”™è¯¯åŸå› **: `"APIè°ƒç”¨å¤±è´¥: 401 Unauthorized"`
- **é™çº§ç­–ç•¥**: ä½¿ç”¨åŸå§‹æç¤ºè¯ `"ä¸€åªå¯çˆ±çš„å°çŒ«"`
- **ä¸šåŠ¡å½±å“**: æ— å½±å“,å›¾ç‰‡ç”Ÿæˆç»§ç»­è¿›è¡Œ

---

## æ—¥å¿—æŸ¥çœ‹æŠ€å·§

### æ–¹æ³• 1: å®æ—¶æŸ¥çœ‹ç»ˆç«¯

å¯åŠ¨å¼€å‘æœåŠ¡å™¨å:
```bash
npm run dev
```

åœ¨ç»ˆç«¯ä¸­ä¼šçœ‹åˆ°å½©è‰²çš„æ—¥å¿—è¾“å‡º,å…³æ³¨å¸¦æœ‰ `PromptOptimizer` çš„è¡Œã€‚

### æ–¹æ³• 2: è¿‡æ»¤å…³é”®æ—¥å¿—

å¦‚æœæ—¥å¿—å¤ªå¤š,å¯ä»¥è¿‡æ»¤:
```bash
npm run dev 2>&1 | grep -A 2 "æç¤ºè¯"
```

### æ–¹æ³• 3: æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶

æ—¥å¿—ä¼šä¿å­˜åœ¨æ–‡ä»¶ä¸­(å¦‚æœé…ç½®äº†æ–‡ä»¶è¾“å‡º),æŸ¥æ‰¾:
- `ğŸ“ åŸå§‹æç¤ºè¯`
- `âœ¨ ä¼˜åŒ–åæç¤ºè¯`

---

## æ›´å¤šç¤ºä¾‹

### ç¤ºä¾‹ 2: å¤æ‚ç‰©ä½“

**è¾“å…¥**: `"ä¸€ä¸ªé•‚ç©ºçš„èŠ±ç“¶"`

**ä¼˜åŒ–å**:
```
"simple vase, solid walls, smooth curves, wide base for stability, no hollow patterns, thick structure, clean edges, matte surface, plain background, front view, 3D printable design"
```

**å…³é”®å˜åŒ–**:
- âŒ ç§»é™¤äº†"é•‚ç©º"(3Dæ‰“å°å›°éš¾)
- âœ… æ·»åŠ äº†"å®å¿ƒå¢™å£"(solid walls)
- âœ… æ·»åŠ äº†"ç¨³å®šåº•åº§"(wide base for stability)

### ç¤ºä¾‹ 3: å¤©ä½¿é›•å¡‘

**è¾“å…¥**: `"ä¸€ä¸ªå¸¦ç¿…è†€çš„å¤©ä½¿é›•å¡‘"`

**ä¼˜åŒ–å**:
```
"angel statue, compact wing design, thick feathers, solid body structure, stable base, clear facial features, symmetrical wings, no thin extensions, smooth surface, white background, 3/4 view, 3D print optimized"
```

**å…³é”®å˜åŒ–**:
- âœ… æ·»åŠ äº†"ç´§å‡‘çš„ç¿…è†€è®¾è®¡"(compact wing design)
- âœ… æ·»åŠ äº†"åšå®çš„ç¾½æ¯›"(thick feathers)
- âœ… å¼ºè°ƒäº†"æ— ç»†é•¿çªå‡º"(no thin extensions)
